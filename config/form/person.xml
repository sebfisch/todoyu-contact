<?xml version="1.0" encoding="UTF-8"?>
<form>
	<attributes>
		<attribute name="action">?ext=contact&amp;controller=person</attribute>
		<attribute name="name">person</attribute>
	</attributes>
	<hiddenFields>
		<field name="id" />
		<field name="image_id" />
	</hiddenFields>
	<fieldsets>

		<fieldset name="main">
			<legend>Main person data</legend>
			<elements>

				<field type="radio" name="salutation">
					<label>contact.ext.person.attr.salutation</label>
					<source type="list">
						<option>
							<value>m</value>
							<label>contact.ext.person.attr.salutation.m</label>
						</option>
						<option>
							<value>w</value>
							<label>contact.ext.person.attr.salutation.f</label>
						</option>
					</source>
				</field>

				<field type="text" name="lastname">
					<label>contact.ext.person.attr.lastname</label>
					<required/>
				</field>

				<field type="text" name="firstname">
					<label>contact.ext.person.attr.firstname</label>
					<required />
				</field>

				<field type="text" name="shortname">
					<label>contact.ext.person.attr.shortname</label>
				</field>

				<field type="date" name="birthday">
					<label>contact.ext.person.attr.birthday</label>
					<calendar>
						<range>[1940,2020]</range>
					</calendar>
					<storeAsDate />
				</field>

				<field type="textarea" name="comment">
					<label>contact.ext.person.attr.comment</label>
					<rows>5</rows>
					<restrict>
						<allow ext="contact" right="person:editComment" />
					</restrict>
				</field>

			</elements>
		</fieldset>

		<fieldset name="image">
			<legend>Image</legend>
			<elements>

				<field type="comment" name="preview">
					<comment type="function">
						<function>TodoyuContactPersonManager::getPreviewImageForm</function>
					</comment>
				</field>
				<field type="button" name="upload">
					<text>LLL:contact.ext.person.attr.image.upload</text>
					<class>buttonUploadContactImage</class>
					<onclick>Todoyu.Ext.contact.Upload.showUploadForm(this.form, 'person')</onclick>
				</field>
				<field type="button" name="remove">
					<text>LLL:contact.ext.contactimage.upload.remove</text>
					<class>buttonRemoveContactImage</class>
					<onclick>Todoyu.Ext.contact.Upload.removeImage(this.form, 'person')</onclick>
				</field>

			</elements>
		</fieldset>

		<fieldset name="relations">
			<legend>Person relations</legend>
			<elements>

				<field type="databaseRelation" name="contactinfo">
					<label>contact.ext.contactinfo</label>
					<addLabel>contact.ext.contactinfo.new</addLabel>
					<record>
						<form>ext/contact/config/form/contactinfo.xml</form>
						<url>
							<ext>contact</ext>
							<controller>person</controller>
						</url>
						<label type="function">
							<function>TodoyuContactViewHelper::getContactinfoLabel</function>
							<noLabel>contact.ext.contactinfo.new</noLabel>
						</label>
					</record>
				</field>

				<field type="databaseRelation" name="address">
					<label>contact.ext.address</label>
					<addLabel>contact.ext.address.new</addLabel>
					<record>
						<form>ext/contact/config/form/address.xml</form>
						<url>
							<ext>contact</ext>
							<controller>person</controller>
						</url>
						<label type="function">
							<function>TodoyuContactViewHelper::getAddressLabel</function>
							<noLabel>contact.ext.address.new</noLabel>
						</label>
					</record>
				</field>

				<field type="databaseRelation" name="company">
					<label>contact.ext.person.attr.company</label>
					<addLabel>contact.ext.company.new</addLabel>
					<record>
						<form>ext/contact/config/form/person-company.xml</form>
						<url>
							<ext>contact</ext>
							<controller>person</controller>
						</url>
						<label type="function">
							<function>TodoyuContactViewHelper::getCompanyLabel</function>
							<noLabel>contact.ext.person.attr.company.new</noLabel>
						</label>
					</record>
				</field>

			</elements>
		</fieldset>


		<fieldset name="account">
			<legend>Login account</legend>
			<restrict>
				<allow ext="contact" right="person:enableLogin" />
			</restrict>
			<elements>

				<field type="checkbox" name="is_active">
					<label>contact.ext.person.attr.is_active</label>
				</field>

				<fieldset name="loginfields">
					<elements>

						<field type="text" name="username">
							<label>contact.ext.person.attr.username</label>
							<validate>
								<unique>
									<table>ext_contact_person</table>
									<allowEmpty />
								</unique>
							</validate>
							<required>
								<noCheck />
							</required>
						</field>

						<field type="text" name="password">
							<label>contact.ext.person.attr.password</label>
							<type>password</type>
							<validate>
								<goodPassword>
									<allowEmpty />
								</goodPassword>
							</validate>
							<required>
								<noCheck />
							</required>
							<textAfterField>LLL:contact.ext.person.attr.password.hasPassword</textAfterField>
						</field>

						<field type="text" name="email">
							<label>contact.ext.person.attr.email</label>
							<validate>
								<email>
									<allowEmpty />
								</email>
								<requiredIfNotEmpty>
									<fields>username,is_active</fields>
								</requiredIfNotEmpty>
							</validate>
							<required>
								<noCheck />
							</required>
						</field>

						<field type="checkbox" name="is_admin">
							<label>contact.ext.person.attr.is_admin</label>
							<restrictAdmin />
						</field>

						<field type="databaseRelation" name="role">
							<label>core.global.roles</label>
							<restrict>
								<allow ext="contact" right="person:setRole" />
							</restrict>
							<addLabel>core.global.role.new</addLabel>
							<record>
								<form>ext/contact/config/form/person-role.xml</form>
								<url>
									<ext>contact</ext>
									<controller>person</controller>
								</url>
								<label type="field">
									<field>title</field>
									<noLabel>contact.ext.person.attr.role.new</noLabel>
								</label>
							</record>
							<validate>
								<requiredIfNotEmpty>
									<fields>username</fields>
									<except>is_admin</except>
								</requiredIfNotEmpty>
							</validate>
							<required>
								<noCheck />
							</required>
						</field>
					</elements>
				</fieldset>

			</elements>
		</fieldset>

		<fieldset name="buttons">
			<legend>Actions</legend>
			<class>buttons</class>
			<elements>

				<field type="cancelButton" name="cancel">
					<onclick>Todoyu.Ext.contact.Person.closeForm(this.form)</onclick>
				</field>

				<field type="saveButton" name="save">
					<onclick>Todoyu.Ext.contact.Person.save(this.form)</onclick>
				</field>

			</elements>
		</fieldset>

	</fieldsets>
</form>